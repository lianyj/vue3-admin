import{_ as e}from"./element-plus.392249c9.js";import{p as a}from"./index.5b6ae43b.js";import"./vue.6371db79.js";import{a as t}from"./axios.6127bb87.js";import{a8 as l,a9 as o,P as d,o as s,d as i,N as r,F as n,S as u,u as m,f as p,aa as h,U as b}from"./@vue.07e3533d.js";import"./dayjs.2a17732a.js";import"./lodash.ebb3c926.js";import"./mitt.33133208.js";import"./async-validator.e3a73323.js";import"./@popperjs.6ab8fae4.js";import"./resize-observer-polyfill.06552ccc.js";import"./normalize-wheel.d56ec257.js";import"./@sentry.2890fdbd.js";import"./tslib.e2371a99.js";import"./vue-router.b8b6d224.js";const c={name:"OrderDetail",data:()=>({dialogVisible:!1,isEdit:!1,id:null,orderId:null,data:{},itemData:{},tableData:[],userList:[],goodList:[]}),methods:{deleteItem(a){t.get("/order/item/delete/"+a).then((a=>{console.log(a),e.success("删除成功"),this.getOrderDetail()}))},modifyItemShow(e){this.itemData=e,this.dialogVisible=!0},modifyItem(){t.post("/order/item/update",{orderId:this.orderId,orderItemId:this.itemData.orderItemId,goodsId:this.itemData.goodsId,goodsIntro:this.itemData.goodsIntro,goodsCount:this.itemData.goodsCount}).then((a=>{console.log(a),e.success("修改成功"),this.dialogVisible=!1,this.getOrderDetail()}))},addItemDataShow(){this.itemData={},this.dialogVisible=!0},addItemData(){t.post("/order/item/add",{orderId:this.orderId,goodsId:this.itemData.goodsId,goodsIntro:this.itemData.goodsIntro,goodsCount:this.itemData.goodsCount}).then((a=>{console.log(a),this.dialogVisible=!1,e.success("新增成功"),this.getOrderDetail()}))},handleClose(){this.dialogVisible=!1},onSubmit(){t.post("/order/edit",{userId:this.data.userId,orderId:this.orderId,expressFee:this.data.expressFee,remark:this.data.remark,orderDate:this.data.orderDate}).then((a=>{console.log(a),e.success("修改成功"),window.location.load()}))},getOrderDetail(){t.get("/orders/"+this.orderId).then((e=>{console.log(e),this.data=e,this.tableData=e.orderItemVOS}))},getUserList(){t.get("/user/allList").then((e=>{console.log(e),this.userList=e}))},getGoodList(){t.get("/good/allList").then((e=>{console.log(e),this.goodList=e}))},printPdf(){window.open(a+"/order/print/"+this.data.orderId+"/"+this.data.printName,"_blank")}},watch:{"data.userId":{handler(e,a){for(const t in this.userList)if(this.userList[t].userId===e){this.data.userName=this.userList[t].userName,this.data.contactName=this.userList[t].contactName,this.data.mobile=this.userList[t].mobile,this.data.address=this.userList[t].address;break}}},"itemData.goodsId":{handler(e,a){for(const t in this.goodList)if(this.goodList[t].goodsId===e){this.itemData.goodsName=this.goodList[t].goodsName,this.itemData.sphere="球镜:"+this.goodList[t].sphereMin+" ~ "+this.goodList[t].sphereMax,this.itemData.cylinder="柱镜:"+this.goodList[t].cylinderMin+" ~ "+this.goodList[t].cylinderMax,this.itemData.originalPrice=this.goodList[t].originalPrice,this.itemData.sellingPrice=parseFloat(this.goodList[t].originalPrice*this.data.costRate).toFixed(2);break}}}},created(){const e=this.$route.query.id;this.orderId=e,this.getOrderDetail(),this.getUserList(),this.getGoodList()}},g=h("data-v-54c4b975");l("data-v-54c4b975");const f={class:"data"},I=b("立即修改"),D=r("hr",{style:{"border-style":"dashed"}},null,-1),y=b("新增"),_=b("打印"),V=b("修改"),k=b("删除"),L={style:{width:"50%"}},C={class:"dialog-footer"},w=b("取 消"),v=b("修 改"),j=b("新 增");o();const N=g(((e,a,t,l,o,h)=>{const b=d("el-option"),c=d("el-select"),N=d("el-form-item"),x=d("el-col"),U=d("el-date-picker"),P=d("el-input"),S=d("el-row"),F=d("el-button"),O=d("el-form"),M=d("el-table-column"),z=d("el-table"),G=d("el-dialog");return s(),i(n,null,[r("div",f,[r(O,{ref:"form",model:o.data,"label-width":"80px"},{default:g((()=>[r(S,{gutter:24},{default:g((()=>[r(x,{span:12},{default:g((()=>[r(N,{label:"选择用户"},{default:g((()=>[r(c,{modelValue:o.data.userId,"onUpdate:modelValue":a[1]||(a[1]=e=>o.data.userId=e),filterable:"",placeholder:"请选择"},{default:g((()=>[(s(!0),i(n,null,u(o.userList,(e=>(s(),i(b,{key:e.userId,label:e.userName+"-"+e.contactName+"-"+e.userLevelStr,value:e.userId},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),r(N,{label:"客户名称"},{default:g((()=>[r("span",null,[r("label",null,m(o.data.userName),1)])])),_:1}),r(N,{label:"联系人"},{default:g((()=>[r("span",null,[r("label",null,m(o.data.contactName),1)])])),_:1}),r(N,{label:"联系电话"},{default:g((()=>[r("span",null,[r("label",null,m(o.data.mobile),1)])])),_:1}),r(N,{label:"联系地址"},{default:g((()=>[r("span",null,[r("label",null,m(o.data.address),1)])])),_:1})])),_:1}),r(x,{span:12},{default:g((()=>[r(N,{label:"订单Id"},{default:g((()=>[r("span",null,[r("label",null,m(o.data.orderId),1)])])),_:1}),r(N,{label:"订单编号"},{default:g((()=>[r("span",null,[r("label",null,m(o.data.orderNo),1)])])),_:1}),r(N,{label:"订单日期"},{default:g((()=>[r("span",null,[r(U,{modelValue:o.data.orderDate,"onUpdate:modelValue":a[2]||(a[2]=e=>o.data.orderDate=e),type:"date","default-value":"data.orderDate",placeholder:"选择日期",clearable:""},null,8,["modelValue"])])])),_:1}),r(N,{label:"快递费用"},{default:g((()=>[r("span",null,[r(P,{modelValue:o.data.expressFee,"onUpdate:modelValue":a[3]||(a[3]=e=>o.data.expressFee=e),"default-value":"data.expressFee",clearable:""},null,8,["modelValue"])])])),_:1}),r(N,{label:"备注"},{default:g((()=>[r("span",null,[r(P,{modelValue:o.data.remark,"onUpdate:modelValue":a[4]||(a[4]=e=>o.data.remark=e),"default-value":"data.remark",clearable:""},null,8,["modelValue"])])])),_:1})])),_:1})])),_:1}),r(S,{style:{"margin-left":"50%"}},{default:g((()=>[r(F,{type:"primary",onClick:h.onSubmit},{default:g((()=>[I])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])]),D,r(F,{type:"primary",onClick:h.addItemDataShow},{default:g((()=>[y])),_:1},8,["onClick"]),r(F,{type:"primary",onClick:h.printPdf},{default:g((()=>[_])),_:1},8,["onClick"]),r(z,{data:o.tableData,border:"",style:{width:"100%"}},{default:g((()=>[p("      <el-table-column"),p('          prop="goodsId"'),p('          label="产品编号"'),p("      >"),p("      </el-table-column>"),r(M,{prop:"goodsName",label:"产品名称"}),r(M,{prop:"goodsIntro",label:"光度"}),r(M,{prop:"goodsUnit",align:"center",label:"单位"}),r(M,{prop:"goodsCount",label:"数量"}),r(M,{prop:"originalPrice",label:"单价"}),r(M,{prop:"sellingPrice",label:"折后金额"}),r(M,{label:"操作"},{default:g((e=>[e.row.goodsId?(s(),i(F,{key:0,type:"primary",onClick:a=>h.modifyItemShow(e.row)},{default:g((()=>[V])),_:2},1032,["onClick"])):p("v-if",!0),e.row.goodsId?(s(),i(F,{key:1,type:"primary",onClick:a=>h.deleteItem(e.row.orderItemId)},{default:g((()=>[k])),_:2},1032,["onClick"])):p("v-if",!0)])),_:1})])),_:1},8,["data"]),r(G,{title:"提示",modelValue:o.dialogVisible,"onUpdate:modelValue":a[9]||(a[9]=e=>o.dialogVisible=e),width:"60%","before-close":h.handleClose},{footer:g((()=>[r("span",C,[r(F,{onClick:a[8]||(a[8]=e=>o.dialogVisible=!1)},{default:g((()=>[w])),_:1}),o.itemData.orderItemId?(s(),i(F,{key:0,type:"primary",onClick:h.modifyItem},{default:g((()=>[v])),_:1},8,["onClick"])):(s(),i(F,{key:1,type:"primary",onClick:h.addItemData},{default:g((()=>[j])),_:1},8,["onClick"]))])])),default:g((()=>[r(O,{ref:"form",model:o.itemData,"label-width":"80px"},{default:g((()=>[r(N,{label:"选择产品"},{default:g((()=>[r(c,{modelValue:o.itemData.goodsId,"onUpdate:modelValue":a[5]||(a[5]=e=>o.itemData.goodsId=e),filterable:"",placeholder:"请选择"},{default:g((()=>[(s(!0),i(n,null,u(o.goodList,(e=>(s(),i(b,{key:e.goodsId,label:e.goodsName,value:e.goodsId},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),r(N,{label:"产品名称"},{default:g((()=>[r("span",null,[r("label",L,m(o.itemData.goodsName)+" ("+m(o.itemData.sphere)+" "+m(o.itemData.cylinder)+")",1)])])),_:1}),r(N,{label:"光度"},{default:g((()=>[r("span",null,[r(P,{modelValue:o.itemData.goodsIntro,"onUpdate:modelValue":a[6]||(a[6]=e=>o.itemData.goodsIntro=e),"default-value":"itemData.goodsIntro",style:{width:"50%"},clearable:""},null,8,["modelValue"])])])),_:1}),r(N,{label:"数量"},{default:g((()=>[r("span",null,[r(P,{modelValue:o.itemData.goodsCount,"onUpdate:modelValue":a[7]||(a[7]=e=>o.itemData.goodsCount=e),"default-value":"itemData.goodsCount",style:{width:"50%"},clearable:""},null,8,["modelValue"])])])),_:1}),r(N,{label:"单价"},{default:g((()=>[r("span",null,[r("label",null,m(o.itemData.originalPrice),1)])])),_:1}),r(N,{label:"折后金额"},{default:g((()=>[r("span",null,[r("label",null,m(o.itemData.sellingPrice),1)])])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","before-close"])],64)}));c.render=N,c.__scopeId="data-v-54c4b975";export{c as default};
